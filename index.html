<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚æ‰¾æ‰¾çœ‹ - å®Œæ•´å„ªåŒ–ç‰ˆ</title>
    <style>
        :root { 
            --primary: #1b5e20; 
            --found: #c8e6c9; 
            --select: #ff9800; 
            --bg: #f9fbe7; 
            --hint-bg: #fff9c4; 
            --border-color: #81c784;
        }
        
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px; 
        }

        /* é ‚éƒ¨æ§åˆ¶é¢æ¿ */
        .panel { 
            background: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        
        .timer-box { 
            background: #333; 
            color: #00ff00; 
            padding: 5px 15px; 
            border-radius: 10px; 
            font-family: monospace; 
            font-size: 1.2rem; 
        }

        #gameArea { 
            display: none; 
            flex-direction: column; 
            align-items: center; 
            width: 100%; 
            max-width: 800px;
            gap: 15px; 
        }

        /* 1. ç©æ³•èªªæ˜ (ä½æ–¼æœ€ä¸Šæ–¹) */
        .instruction-banner {
            background-color: var(--hint-bg);
            border: 2px dashed #fbc02d;
            border-radius: 50px;
            padding: 12px 30px;
            color: #af6000;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease-out;
        }

        /* 2. ç›®æ¨™è©å½™æ¸…å–® (5å€‹ä¸€è¡Œ) */
        .target-list { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 12px; 
            width: 100%;
            margin-bottom: 10px; 
        }

        .target-item { 
            box-sizing: border-box;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: white; 
            border: 3px solid var(--border-color); 
            border-radius: 12px; 
            font-weight: bold; 
            color: #2e7d32; 
            box-shadow: 0 4px 0px #c8e6c9; 
            transition: 0.3s;
            /* é è¨­ 5 å€‹ä¸€è¡Œçš„å¯¬åº¦è¨ˆç®— */
            flex: 0 0 calc(20% - 12px); 
            min-height: 50px;
        }

        .target-item.done { 
            background: #e0e0e0; 
            border-color: #bdbdbd; 
            opacity: 0.5; 
            text-decoration: line-through; 
            box-shadow: none; 
            transform: translateY(4px);
        }

        /* 3. éŠæˆ²ç¶²æ ¼ */
        .grid-box { 
            background: #a5d6a7; 
            padding: 15px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        }
        
        .grid { 
            display: grid; 
            gap: 8px; 
            user-select: none; 
        }
        
        .cell { 
            background: white; 
            border-radius: 8px; 
            transition: 0.2s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            border: 1px solid #eee; 
            font-weight: bold;
        }
        
        .cell.found { background: var(--found) !important; color: #1b5e20; cursor: default; }
        .cell.selected { background: var(--select) !important; color: white; transform: scale(0.95); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        select, button { padding: 10px 15px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; font-weight: bold; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; transition: 0.2s; }
        button:hover { background: #2e7d32; transform: scale(1.05); }
    </style>
</head>
<body>

    <h1 style="color: #2e7d32; margin-bottom: 10px;">ğŸ” å¿«æ¨‚æ‰¾æ‰¾çœ‹</h1>
    
    <div class="panel">
        <select id="diff">
            <option value="å¹¼å…’">5x5 å¹¼å…’ç‰ˆ (5å€‹å–®åœ–)</option>
            <option value="ä½å¹´ç´š">5x5 ä½å¹´ç´šç‰ˆ (2å€‹æˆèª)</option>
            <option value="ä¸­å¹´ç´š" selected>8x8 ä¸­å¹´ç´šç‰ˆ (5å€‹æˆèª)</option>
            <option value="æ¨™æº–">10x10 æ¨™æº–ç‰ˆ (10å€‹æˆèª)</option>
            <option value="é”äºº">15x15 é”äººç‰ˆ (15å€‹æˆèª)</option>
        </select>
        <button onclick="startGame()">å»ºç«‹æ–°éŠæˆ²</button>
        <div class="timer-box" id="timerDisplay">00:00</div>
    </div>

    <div id="gameArea">
        <div class="instruction-banner" id="instructionText"></div>

        <div class="target-list" id="targetList"></div>
        
        <div class="grid-box">
            <div class="grid" id="gameGrid"></div>
        </div>
    </div>

    <script>
        const IDIOMS = ["ä¸€æ¯›ä¸æ‹”","ä¼¼æ˜¯è€Œé","åå…¨åç¾","ä¸€å¿ƒä¸€æ„","ä¸‰å¿ƒäºŒæ„","å››å¹³å…«ç©©","äº”å…‰åè‰²","å…­ç¥ç„¡ä¸»","ä¸ƒæ‰‹å…«è…³","å…«é¢ç²ç“","ä¹ç‰›ä¸€æ¯›","æœæ°£è“¬å‹ƒ","é´‰é›€ç„¡è²","ä¸€ç›®åè¡Œ","è¿«ä¸åŠå¾…","åŠé€”è€Œå»¢","å¤§å…¬ç„¡ç§","å®ˆæ ªå¾…å…”","ç•«è›‡æ·»è¶³","æ©è€³ç›œéˆ´","äº¡ç¾Šè£œç‰¢","æ‹”è‹—åŠ©é•·","ååˆ—å‰èŒ…","åæ­£è¨€é †","è¨€è¡Œä¸€è‡´","çŸ¥è¡Œåˆä¸€","å¦‚è™æ·»ç¿¼","é¾é¦¬ç²¾ç¥","ç”Ÿé¾æ´»è™","äº•åº•ä¹‹è›™","å°ç‰›å½ˆç´","æœ›æ¢…æ­¢æ¸´","èé›èµ·èˆ","ç²¾ç›Šæ±‚ç²¾","é¥è€Œä¸æ¨","å …æŒä¸æ‡ˆ","å…¨åŠ›ä»¥èµ´","å‰ç¨‹ä¼¼éŒ¦","é‡‘ç‰è‰¯è¨€","å‡ºå£æˆç« ","å¦™èªå¦‚ç ","èƒ¸æœ‰æˆç«¹","å¾ªåºæ¼¸é€²","å»¢å¯¢å¿˜é£Ÿ","æ‡¸æ¨‘åˆºè‚¡","é‘¿å£å·å…‰","åšå­¸å¤šæ‰","æº«æ•…çŸ¥æ–°","ä¸æ¥ä¸‹å•","èˆ‰ä¸€åä¸‰"];
        const EMOJI_POOL = ["ğŸ","ğŸŒ","ğŸ‡","ğŸŠ","ğŸ“","ğŸ","ğŸ¥","ğŸ’","ğŸ¶","ğŸ±","ğŸ°","ğŸ¹","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸš—","ğŸš€","ğŸ›¸","ğŸš¢","ğŸš²","â­","ğŸŒˆ","â˜€ï¸","ğŸ€","ğŸ’","ğŸ”","ğŸ•","ğŸŸ","ğŸ¦","ğŸ©"];
        const CHARS = "çš„ä¸€æ˜¯åœ¨ä¸äº†æœ‰å’Œäººé€™ä¸­å¤§ä¾†ä¸Šå€‹åœ‹æˆ‘åˆ°èªªå€‘ç‚ºå­å’Œä½ ä¸å¾Œå‡ºé“ä¹Ÿå¾—è£¡ä¸‹è‡ªå¾—ä¹‹æ™‚å¾Œéè€Œå®¶å¤š";

        const SETTINGS = {
            "å¹¼å…’": { size: 5, count: 5, cell: 80, type: 'emoji' },
            "ä½å¹´ç´š": { size: 5, count: 2, cell: 80, type: 'text' },
            "ä¸­å¹´ç´š": { size: 8, count: 5, cell: 60, type: 'text' },
            "æ¨™æº–": { size: 10, count: 10, cell: 50, type: 'text' },
            "é”äºº": { size: 15, count: 15, cell: 40, type: 'text' }
        };

        let current = {}, grid = [], targets = [], foundWords = [], foundCoords = new Set(), first = null;
        let startTime, timerInterval;

        function startGame() {
            const diffKey = document.getElementById('diff').value;
            current = SETTINGS[diffKey];
            
            // æ›´æ–°æç¤º
            const instrEl = document.getElementById('instructionText');
            instrEl.innerHTML = current.type === 'emoji' ? 
                `ğŸ’¡ ç©æ³•æç¤ºï¼šè«‹é»é¸ç›®æ¨™åœ–æ¡ˆ` : 
                `ğŸ’¡ ç©æ³•æç¤ºï¼šé»é¸æˆèªçš„ã€Œç¬¬ä¸€å€‹å­—ã€èˆ‡ã€Œæœ€å¾Œä¸€å€‹å­—ã€`;

            let pool = current.type === 'emoji' ? [...EMOJI_POOL] : [...IDIOMS];
            pool.sort(() => Math.random() - 0.5);
            targets = pool.slice(0, current.count);
            
            foundWords = []; foundCoords.clear(); first = null;
            clearInterval(timerInterval);
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);

            grid = Array(current.size).fill().map(() => Array(current.size).fill(null));
            targets.forEach(word => {
                let placed = false;
                while (!placed) { if (placeWord(word)) placed = true; }
            });

            const currentTargetsSet = new Set(targets);
            const rawFiller = current.type === 'emoji' ? EMOJI_POOL : Array.from(CHARS);
            const safeFiller = rawFiller.filter(item => !currentTargetsSet.has(item));

            for (let y = 0; y < current.size; y++) {
                for (let x = 0; x < current.size; x++) {
                    if (!grid[y][x]) grid[y][x] = safeFiller[Math.floor(Math.random() * safeFiller.length)];
                }
            }
            document.getElementById('gameArea').style.display = 'flex';
            render();
        }

        function placeWord(word) {
            const chars = Array.from(word);
            const dirs = [[1,0],[0,1],[1,1],[1,-1],[0,-1],[-1,0],[-1,-1],[-1,1]];
            const d = dirs[Math.floor(Math.random() * dirs.length)];
            const sx = Math.floor(Math.random() * current.size), sy = Math.floor(Math.random() * current.size);
            for (let i = 0; i < chars.length; i++) {
                const nx = sx + i * d[0], ny = sy + i * d[1];
                if (nx < 0 || nx >= current.size || ny < 0 || ny >= current.size) return false;
                if (grid[ny][nx] && grid[ny][nx] !== chars[i]) return false;
            }
            for (let i = 0; i < chars.length; i++) grid[sy + i * d[1]][sx + i * d[0]] = chars[i];
            return true;
        }

        function updateTimer() {
            const diff = Math.floor((new Date() - startTime) / 1000);
            document.getElementById('timerDisplay').innerText = 
                `${Math.floor(diff/60).toString().padStart(2,'0')}:${(diff%60).toString().padStart(2,'0')}`;
        }

        function render() {
            const list = document.getElementById('targetList');
            list.innerHTML = '';
            
            targets.forEach(w => {
                const item = document.createElement('div');
                item.id = `t-${w}`;
                item.className = `target-item ${foundWords.includes(w) ? 'done' : ''}`;
                item.innerText = w;

                if (current.type === 'emoji') {
                    // å¹¼å…’ç‰ˆï¼šå¯¬é«˜å®Œå…¨åŒ¹é…æ ¼å­å¤§å°
                    item.style.width = `${current.cell}px`;
                    item.style.height = `${current.cell}px`;
                    item.style.flex = "0 0 auto"; // å–æ¶ˆ 5å€‹ä¸€è¡Œçš„ flex ç¸®æ”¾
                    item.style.fontSize = `${current.cell * 0.6}px`;
                } else {
                    // æ–‡å­—ç‰ˆï¼šæ¡ç”¨ CSS è¦å®šçš„ 5 å€‹ä¸€è¡Œä½ˆå±€
                    item.style.fontSize = '1.1rem';
                }
                list.appendChild(item);
            });

            const gridEl = document.getElementById('gameGrid');
            gridEl.style.gridTemplateColumns = `repeat(${current.size}, ${current.cell}px)`;
            gridEl.innerHTML = '';
            grid.forEach((row, y) => {
                row.forEach((char, x) => {
                    const cell = document.createElement('div');
                    cell.className = `cell ${foundCoords.has(`${x},${y}`) ? 'found' : ''} ${first && first.x === x && first.y === y ? 'selected' : ''}`;
                    cell.style.width = cell.style.height = `${current.cell}px`;
                    cell.style.fontSize = `${current.cell * 0.55}px`;
                    cell.innerText = char;
                    cell.onclick = () => handleSelect(x, y);
                    gridEl.appendChild(cell);
                });
            });
        }

        function handleSelect(x, y) {
            if (foundCoords.has(`${x},${y}`)) return;
            const clickedChar = grid[y][x];

            if (current.type === 'emoji') {
                if (targets.includes(clickedChar) && !foundWords.includes(clickedChar)) {
                    foundWords.push(clickedChar);
                    foundCoords.add(`${x},${y}`);
                    if (foundWords.length === targets.length) {
                        clearInterval(timerInterval);
                        setTimeout(() => alert("ğŸ‰ å¤ªæ£’äº†ï¼å…¨éƒ¨æ‰¾åˆ°äº†ï¼"), 300);
                    }
                }
                render();
            } else {
                if (!first) { first = { x, y }; render(); }
                else {
                    const word = getWord(first, { x, y });
                    const rev = Array.from(word || "").reverse().join('');
                    let match = targets.includes(word) ? word : (targets.includes(rev) ? rev : null);
                    if (match && !foundWords.includes(match)) {
                        foundWords.push(match);
                        markFound(first, { x, y });
                        if (foundWords.length === targets.length) {
                            clearInterval(timerInterval);
                            setTimeout(() => alert("ğŸŠ æ­å–œå®ŒæˆæŒ‘æˆ°ï¼"), 300);
                        }
                    }
                    first = null; render();
                }
            }
        }

        function getWord(p1, p2) {
            const dx = p2.x - p1.x, dy = p2.y - p1.y, dist = Math.max(Math.abs(dx), Math.abs(dy));
            if (dx !== 0 && dy !== 0 && Math.abs(dx) !== Math.abs(dy)) return null;
            const sx = dx === 0 ? 0 : dx / Math.abs(dx), sy = dy === 0 ? 0 : dy / Math.abs(dy);
            let s = "";
            for (let i = 0; i <= dist; i++) s += grid[p1.y + i * sy][p1.x + i * sx];
            return s;
        }

        function markFound(p1, p2) {
            const dx = p2.x - p1.x, dy = p2.y - p1.y, dist = Math.max(Math.abs(dx), Math.abs(dy));
            const sx = dx === 0 ? 0 : dx / Math.abs(dx), sy = dy === 0 ? 0 : dy / Math.abs(dy);
            for (let i = 0; i <= dist; i++) foundCoords.add(`${p1.x + i * sx},${p1.y + i * sy}`);
        }
    </script>
</body>
</html>
