<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æˆèªæ‰¾å­—æŒ‘æˆ°è³½ - è¨ˆæ™‚æŒ‘æˆ°ç‰ˆ</title>
    <style>
        :root { --primary: #1b5e20; --found: #c8e6c9; --select: #ff9800; --bg: #f9fbe7; --win: #ffd700; --accent: #ff5722; --hint-bg: #fff9c4; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; overflow-x: hidden; }
        
        .panel { background: white; padding: 15px 30px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center; z-index: 10; display: flex; align-items: center; gap: 15px; }
        
        /* ğŸ•’ è¨ˆæ™‚å™¨æ¨£å¼ */
        .timer-box { background: #333; color: #00ff00; padding: 5px 15px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; border: 2px solid #555; min-width: 80px; }

        #gameArea { display: none; flex-direction: column; align-items: center; width: 100%; gap: 15px; z-index: 10; }

        .instruction-tag { 
            background: var(--hint-bg); color: #af6000; padding: 10px 25px; border-radius: 25px; 
            font-weight: bold; font-size: 1.1rem; border: 2px dashed #fbc02d;
            animation: float-hint 3s infinite ease-in-out; margin-bottom: 10px;
        }
        @keyframes float-hint { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .target-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; width: 100%; max-width: 900px; margin: 0 auto 20px auto; }
        .target-item { display: flex; align-items: center; justify-content: center; padding: 12px 20px; background: #ffffff; border: 3px solid #81c784; border-radius: 15px; font-size: 1.2rem; font-weight: 900; color: #2e7d32; box-shadow: 0 4px 0px #c8e6c9; min-width: 120px; }

        @keyframes super-shake {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); }
            10% { transform: translate(-8px, -4px) rotate(-5deg) scale(1.3); background-color: var(--win); }
            20% { transform: translate(8px, 4px) rotate(5deg) scale(1.3); background-color: var(--accent); color: white; }
            100% { transform: translate(0, 0) rotate(0deg) scale(1); }
        }
        .shake-effect { animation: super-shake 0.5s ease-in-out both; z-index: 100; border-color: var(--accent) !important; box-shadow: 0 0 30px rgba(255, 87, 34, 0.5); }
        .target-item.done { background: #e0e0e0; color: #9e9e9e; text-decoration: line-through; border-color: #bdbdbd; box-shadow: none; transform: translateY(2px); transition: 0.5s; }

        .grid-box { background: #a5d6a7; padding: 15px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .grid { display: grid; gap: 6px; user-select: none; }
        .cell { background: white; text-align: center; font-weight: bold; cursor: pointer; border-radius: 8px; transition: 0.2s; color: #333; }
        .cell.selected { background: var(--select) !important; color: white; transform: scale(1.1); z-index: 5; }
        .cell.found { background: var(--found) !important; color: #1b5e20; cursor: default; }

        @keyframes blink-strong {
            0% { background-color: #fff; transform: scale(1); }
            33% { background-color: var(--win); transform: scale(1.3); box-shadow: 0 0 20px var(--win); }
            100% { background-color: var(--found); transform: scale(1); }
        }
        .blink-effect { animation: blink-strong 0.3s ease-in-out 3; z-index: 10; }

        select, button { padding: 12px 20px; font-size: 16px; border-radius: 10px; border: 1px solid #ddd; cursor: pointer; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; }
        h1 { color: #2e7d32; margin-top: 0; }
    </style>
</head>
<body>

    <h1>ğŸ” å¿«æ¨‚æ‰¾æˆèª</h1>
    
    <div class="panel">
        é›£åº¦é¸æ“‡ï¼š
        <select id="diff">
            <option value="å¹¼å…’" selected>5x5 å¹¼å…’ç‰ˆ (2å€‹è©)</option>
            <option value="ä½å¹´ç´š">8x8 ä½å¹´ç´šç‰ˆ (5å€‹è©)</option>
            <option value="æ¨™æº–">10x10 æ¨™æº–ç‰ˆ (10å€‹è©)</option>
            <option value="é”äºº">15x15 é”äººç‰ˆ (15å€‹è©)</option>
        </select>
        <button onclick="startGame()">å»ºç«‹éŠæˆ²</button>
        <div class="timer-box" id="timerDisplay">00:00</div>
    </div>

    <div id="gameArea">
        <div class="instruction-tag">ğŸ’¡ ç©æ³•æç¤ºï¼šè«‹é»é¸ç›®æ¨™è©å½™çš„ã€Œç¬¬ä¸€å€‹å­—ã€èˆ‡ã€Œæœ€å¾Œä¸€å€‹å­—ã€</div>
        <div class="target-list" id="targetList"></div>
        <div class="grid-box"><div class="grid" id="gameGrid"></div></div>
    </div>

    <script>
        const IDIOMS = ["ä¸€æ¯›ä¸æ‹”","ä¼¼æ˜¯è€Œé","åå…¨åç¾","ä¸€å¿ƒä¸€æ„","ä¸‰å¿ƒäºŒæ„","å››å¹³å…«ç©©","äº”å…‰åè‰²","å…­ç¥ç„¡ä¸»","ä¸ƒæ‰‹å…«è…³","å…«é¢ç²ç“","ä¹ç‰›ä¸€æ¯›","æœæ°£è“¬å‹ƒ","é´‰é›€ç„¡è²","ä¸€ç›®åè¡Œ","è¿«ä¸åŠå¾…","åŠé€”è€Œå»¢","å¤§å…¬ç„¡ç§","å®ˆæ ªå¾…å…”","ç•«è›‡æ·»è¶³","æ©è€³ç›œéˆ´","äº¡ç¾Šè£œç‰¢","æ‹”è‹—åŠ©é•·","ååˆ—å‰èŒ…","åæ­£è¨€é †","è¨€è¡Œä¸€è‡´","çŸ¥è¡Œåˆä¸€","å¦‚è™æ·»ç¿¼","é¾é¦¬ç²¾ç¥","ç”Ÿé¾æ´»è™","äº•åº•ä¹‹è›™","å°ç‰›å½ˆç´","æœ›æ¢…æ­¢æ¸´","èé›èµ·èˆ","ç²¾ç›Šæ±‚ç²¾","é¥è€Œä¸æ¨","å …æŒä¸æ‡ˆ","å…¨åŠ›ä»¥èµ´","å‰ç¨‹ä¼¼éŒ¦","é‡‘ç‰è‰¯è¨€","å‡ºå£æˆç« ","å¦™èªå¦‚ç ","èƒ¸æœ‰æˆç«¹","å¾ªåºæ¼¸é€²","å»¢å¯¢å¿˜é£Ÿ","æ‡¸æ¨‘åˆºè‚¡","é‘¿å£å·å…‰","åšå­¸å¤šæ‰","æº«æ•…çŸ¥æ–°","ä¸æ¥ä¸‹å•","èˆ‰ä¸€åä¸‰"];
        const CHARS = "çš„ä¸€æ˜¯åœ¨ä¸äº†æœ‰å’Œäººé€™ä¸­å¤§ä¾†ä¸Šå€‹åœ‹æˆ‘åˆ°èªªå€‘ç‚ºå­å’Œä½ ä¸å¾Œå‡ºé“ä¹Ÿå¾—è£¡ä¸‹è‡ªå¾—ä¹‹æ™‚å¾Œéè€Œå®¶å¤š";
        const SETTINGS = {
            "å¹¼å…’": { size: 5, count: 2, cell: 75 },
            "ä½å¹´ç´š": { size: 8, count: 5, cell: 55 },
            "æ¨™æº–": { size: 10, count: 10, cell: 45 },
            "é”äºº": { size: 15, count: 15, cell: 38 }
        };

        let current = {}, grid = [], targets = [], foundWords = [], foundCoords = new Set(), first = null;
        let startTime, timerInterval;

        // --- éŸ³æ•ˆç³»çµ± ---
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function playDoubleDingDong() {
            if (!audioCtx) audioCtx = new AudioCtx();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            function triggerNote(freq, startTime, duration = 0.3) {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, startTime);
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.3, startTime + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(startTime); osc.stop(startTime + duration);
            }
            triggerNote(523.25, now); triggerNote(659.25, now + 0.12);
            triggerNote(659.25, now + 0.45); triggerNote(783.99, now + 0.57);
        }

        // --- è¨ˆæ™‚å™¨é‚è¼¯ ---
        function updateTimer() {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').innerText = `${m}:${s}`;
        }

        function startGame() {
            if (!audioCtx) audioCtx = new AudioCtx();
            const diffKey = document.getElementById('diff').value;
            current = SETTINGS[diffKey];
            targets = IDIOMS.sort(() => Math.random() - 0.5).slice(0, current.count);
            foundWords = []; foundCoords.clear(); first = null;
            
            // é‡è¨­èˆ‡å•Ÿå‹•è¨ˆæ™‚å™¨
            clearInterval(timerInterval);
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            document.getElementById('timerDisplay').innerText = "00:00";

            grid = Array(current.size).fill().map(() => Array(current.size).fill(null));
            targets.forEach(word => {
                let placed = false, tries = 0;
                while (!placed && tries < 300) { if (placeWord(word)) placed = true; tries++; }
            });
            for (let y = 0; y < current.size; y++) {
                for (let x = 0; x < current.size; x++) {
                    if (!grid[y][x]) grid[y][x] = CHARS[Math.floor(Math.random() * CHARS.length)];
                }
            }
            document.getElementById('gameArea').style.display = 'flex';
            render();
        }

        function placeWord(word) {
            const dirs = [[1,0],[0,1],[1,1],[1,-1],[0,-1],[-1,0]];
            const d = dirs[Math.floor(Math.random() * dirs.length)];
            const sx = Math.floor(Math.random() * current.size), sy = Math.floor(Math.random() * current.size);
            for (let i = 0; i < word.length; i++) {
                const nx = sx + i * d[0], ny = sy + i * d[1];
                if (nx < 0 || nx >= current.size || ny < 0 || ny >= current.size) return false;
                if (grid[ny][nx] && grid[ny][nx] !== word[i]) return false;
            }
            for (let i = 0; i < word.length; i++) grid[sy + i * d[1]][sx + i * d[0]] = word[i];
            return true;
        }

        function render() {
            const list = document.getElementById('targetList');
            list.innerHTML = targets.map(w => `<div id="t-${w}" class="target-item ${foundWords.includes(w) ? 'done' : ''}">${w}</div>`).join('');
            const gridEl = document.getElementById('gameGrid');
            gridEl.style.gridTemplateColumns = `repeat(${current.size}, ${current.cell}px)`;
            gridEl.innerHTML = '';
            grid.forEach((row, y) => {
                row.forEach((char, x) => {
                    const cell = document.createElement('div');
                    cell.id = `c-${x}-${y}`;
                    cell.className = `cell ${foundCoords.has(`${x},${y}`) ? 'found' : ''} ${first && first.x === x && first.y === y ? 'selected' : ''}`;
                    cell.style.width = cell.style.height = cell.style.lineHeight = `${current.cell}px`;
                    cell.style.fontSize = `${current.cell * 0.55}px`;
                    cell.innerText = char;
                    cell.onclick = () => handleSelect(x, y);
                    gridEl.appendChild(cell);
                });
            });
        }

        function handleSelect(x, y) {
            if (foundCoords.has(`${x},${y}`)) return;
            if (!first) {
                first = { x, y }; render();
            } else {
                const word = getWord(first, { x, y });
                const rev = word ? word.split('').reverse().join('') : "";
                let match = targets.includes(word) ? word : (targets.includes(rev) ? rev : null);
                if (match && !foundWords.includes(match)) {
                    foundWords.push(match);
                    playDoubleDingDong();
                    triggerBlink(first, { x, y });
                    triggerSuperShake(match); 
                    markFound(first, { x, y });
                    if (foundWords.length === targets.length) {
                        clearInterval(timerInterval); // åœæ­¢è¨ˆæ™‚
                        const finalTime = document.getElementById('timerDisplay').innerText;
                        setTimeout(() => { alert(`ğŸŠ ä»»å‹™å®Œæˆï¼ç¸½å…±èŠ±è²»æ™‚é–“ï¼š${finalTime}`); }, 800);
                    }
                }
                first = null; render();
            }
        }

        function triggerSuperShake(word) {
            const targetEl = document.getElementById(`t-${word}`);
            if (targetEl) {
                targetEl.classList.add('shake-effect');
                setTimeout(() => { targetEl.classList.remove('shake-effect'); targetEl.classList.add('done'); }, 600);
            }
        }

        function triggerBlink(p1, p2) {
            const dx = p2.x - p1.x, dy = p2.y - p1.y, dist = Math.max(Math.abs(dx), Math.abs(dy));
            const sx = dx === 0 ? 0 : dx / Math.abs(dx), sy = dy === 0 ? 0 : dy / Math.abs(dy);
            for (let i = 0; i <= dist; i++) {
                const el = document.getElementById(`c-${p1.x + i * sx}-${p1.y + i * sy}`);
                if (el) { el.classList.add('blink-effect'); setTimeout(() => el.classList.remove('blink-effect'), 900); }
            }
        }

        function getWord(p1, p2) {
            const dx = p2.x - p1.x, dy = p2.y - p1.y, dist = Math.max(Math.abs(dx), Math.abs(dy));
            if (dx !== 0 && dy !== 0 && Math.abs(dx) !== Math.abs(dy)) return null;
            const sx = dx === 0 ? 0 : dx / Math.abs(dx), sy = dy === 0 ? 0 : dy / Math.abs(dy);
            let s = "";
            for (let i = 0; i <= dist; i++) s += grid[p1.y + i * sy][p1.x + i * sx];
            return s;
        }

        function markFound(p1, p2) {
            const dx = p2.x - p1.x, dy = p2.y - p1.y, dist = Math.max(Math.abs(dx), Math.abs(dy));
            const sx = dx === 0 ? 0 : dx / Math.abs(dx), sy = dy === 0 ? 0 : dy / Math.abs(dy);
            for (let i = 0; i <= dist; i++) foundCoords.add(`${p1.x + i * sx},${p1.y + i * sy}`);
        }
    </script>
</body>
</html>
